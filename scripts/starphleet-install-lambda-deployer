# install nvm
# because script is run with sudo nvm is put in /root/.nvm making node unavailable to othe envs
# therefore, we move nvm to /home/.nvm and mak it executable
export NVM_DIR="$HOME/.nvm"
if [ ! -s "$NVM_DIR/nvm.sh" ]; then
    curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.0/install.sh | bash
fi 


if [ -s "$NVM_DIR/nvm.sh" ]; then
    source  "$NVM_DIR/nvm.sh"  # This loads nvm
fi    

# install node v6.5.0 required by serverless
nvm install 6.5.0

# Use this version of node
nvm use 6.5.0

# make version 6.5.0 the default version
nvm alias default node

#Other shells may need node. So add nvm version of node and npm to /usr/local/bin

#copy version of node and npm to /usr/bin
n=$(which node); \
n=${n%/bin/node}; 
sudo ln -s "$n/bin/node" "/usr/bin/node"
sudo ln -s "$n/bin/npm" "/usr/bin/npm"


#install serverless framework
echo "" && echo "Install Serverless npm package ---"
npm install -g serverless

# install deployer command line tool
echo "" && echo "install deployer cli tool"
pushd /starphleet/lambda/deployer && npm install -g
